/**
 * @version $Id$
 * @package DJ-MediaTools
 * @subpackage DJ-MediaTools galleryGrid layout
 * @copyright Copyright (C) 2017 DJ-Extensions.com, All rights reserved.
 * @license DJ-Extensions.com Proprietary Use License
 * @author url: http://dj-extensions.com
 * @author email contact@dj-extensions.com
 * @developer Szymon Woronowski - szymon.woronowski@design-joomla.eu
 *
 */
!function(d){var t=window.DJImageGalleryGrid=window.DJImageGalleryGrid||function(t,s){this.options={transition:"swing",duration:250,delay:50},this.init(t,s)};t.prototype.init=function(t,s){var i=this;d.extend(i.options,s),i.grid=d("#"+t),i.grid.length&&(i.slides=i.grid.find(".dj-slide"),i.loaded=0,i.touch="ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints,i.transition=i.support("transition"),i.transform="ifade"==i.options.effect&&i.support("transform"),i.slides.length&&(i.responsive(),i.setEffectsOptions(),i.setSlidesEffects(),i.loadSlides(),i.setGridEvents(),d(window).on("resize",i.responsive.bind(i)),d(window).on("load",i.responsive.bind(i))))},t.prototype.responsive=function(){var t=this,s=t.getSize(t.grid).x;s-=parseInt(t.grid.css("padding-left")),s-=parseInt(t.grid.css("padding-right")),s-=parseInt(t.grid.css("border-left-width")),s-=parseInt(t.grid.css("border-right-width"));var i=Math.ceil(s/(t.options.width+t.options.spacing)),e=Math.floor((s-1)/i-t.options.spacing);t.slides.css("width",e),t.slides.each(function(t){t%i==0?d(this).addClass("dj-first"):d(this).removeClass("dj-first")})},t.prototype.getSize=function(t){var s={};if(t.is(":hidden")){for(var i,e,o=t.parent();o.is(":hidden");)o=(i=o).parent();e=o.width(),i&&(e-=parseInt(i.css("margin-left")),e-=parseInt(i.css("margin-right")),e-=parseInt(i.css("border-left-width")),e-=parseInt(i.css("border-right-width")),e-=parseInt(i.css("padding-left")),e-=parseInt(i.css("padding-right")));var n=t.clone();n.css({position:"absolute",visibility:"hidden","max-width":e}),d(document.body).append(n),s={x:n.width(),y:n.height()},n.remove()}else s={x:t.width(),y:t.height()};return s},t.prototype.setEffectsOptions=function(){var t=this;switch(t.options.effect){case"up":var s=Math.ceil(100*t.options.spacing/t.options.height);t.property="top",t.startEffect={top:100+s+"%"},t.endEffect={top:0};break;case"down":s=Math.ceil(100*t.options.spacing/t.options.height);t.property="top",t.startEffect={top:-1*(100+s)+"%"},t.endEffect={top:0};break;case"left":s=Math.ceil(100*t.options.spacing/t.options.width);t.property="left",t.startEffect={left:100+s+"%"},t.endEffect={left:0};break;case"right":s=Math.ceil(100*t.options.spacing/t.options.width);t.property="left",t.startEffect={left:-1*(100+s)+"%"},t.endEffect={left:0};break;case"fade":default:t.property="opacity",t.startEffect={opacity:0},t.endEffect={opacity:1}}if(t.options.desc_effect)switch(t.options.desc_effect){case"up":s=Math.ceil(100*t.options.spacing/t.options.height);t.desc_property="margin-bottom",t.desc_startEffect={marginBottom:100+s+"%"},t.desc_endEffect={marginBottom:0};break;case"down":s=Math.ceil(100*t.options.spacing/t.options.height);t.desc_property="margin-bottom",t.desc_startEffect={marginBottom:-1*(100+s)+"%"},t.desc_endEffect={marginBottom:0};break;case"left":s=Math.ceil(100*t.options.spacing/t.options.width);t.desc_property="margin-left",t.desc_startEffect={marginLeft:-1*(100+s)+"%"},t.desc_endEffect={marginLeft:0};break;case"right":s=Math.ceil(100*t.options.spacing/t.options.width);t.desc_property="margin-left",t.desc_startEffect={marginLeft:100+s+"%"},t.desc_endEffect={marginLeft:0};break;case"fade":default:t.desc_property="opacity",t.desc_startEffect={opacity:0},t.desc_endEffect={opacity:1}}},t.prototype.setSlidesEffects=function(){var s=this;s.slides.each(function(){var e=d(this);if(e[0].fx=d(this).find(".dj-slide-in").first(),s.transition){e[0].fx.css(s.startEffect);var t=s.property+" "+s.options.duration+"ms "+s.options.css3transition;s.transform&&(t+=", "+s.transform+" "+s.options.duration+"ms "+s.options.css3transition,e[0].fx.css(s.transform,"scale(0.3)")),e[0].fx.css(s.transition,t),t="opacity "+s.options.duration+"ms ease-out "+s.options.delay+"ms",s.transform&&(t+=", "+s.transform+" "+s.options.duration+"ms "+s.options.css3transition+" "+s.options.delay+"ms"),e.css(s.transition,t)}else e[0].fx.css(s.startEffect);(e[0].desc=e.find(".dj-slide-desc").first(),s.options.desc_effect&&e[0].desc.length&&(s.transition?(e[0].desc.css(s.desc_startEffect),e[0].desc.css(s.transition,s.desc_property+" "+s.options.duration+"ms "+s.options.css3transition+" "+s.options.delay+"ms")):e[0].desc.css(s.desc_startEffect)),s.touch)&&e[0].fx.find("img.dj-image").first().on("touchstart",function(t){s.options.desc_effect&&e[0].desc.length&&!e.hasClass("active")&&(e.trigger("mouseenter"),t.preventDefault(),t.stopPropagation())});e.on("mouseenter",function(t){s.slides.each(function(){var t=d(this);t.hasClass("active")&&t!=e&&s.hideItem(t)}),s.showItem(e)}),e.on("mouseleave",s.hideItem.bind(s,e)),e.on("focus",function(t){var s=e.hasClass("active");e.trigger("mouseenter"),e.find(".showOnMouseOver").css("opacity",1);var i=e.find("a[href]").first();!s&&i.length&&i.focus()})})},t.prototype.showItem=function(t){var s=this;t.addClass("active"),s.transition?(t.css("opacity",1),s.transform&&t.css(s.transform,"scale(1.1)")):t.animate({opacity:1},s.options.duration,s.options.transition),s.options.desc_effect&&t[0].desc.length&&(t[0].desc.css("visibility",""),s.transition?t[0].desc.css(s.desc_endEffect):t[0].desc.animate(s.desc_endEffect,s.options.duration,s.options.transition))},t.prototype.hideItem=function(t){var s=this;t.removeClass("active"),s.transition?(t.css("opacity",.3),s.transform&&t.css(s.transform,"scale(1.0)")):t.animate({opacity:.3},s.options.duration,s.options.transition),s.options.desc_effect&&t[0].desc.length&&(s.transition?t[0].desc.css(s.desc_startEffect):t[0].desc.animate(s.desc_startEffect,s.options.duration,s.options.transition),setTimeout(function(){t[0].desc.css("visibility","hidden")},s.options.duration))},t.prototype.loadSlide=function(t,s){var e=this;if(!e.slides[t].loaded){e.slides[t].loaded=!0,e.loaded++;var i=d(e.slides[t]).find("img.dj-image").first(),o=0;s&&(o=t*e.options.delay);var n=function(s,i,t){1<s.length&&(i=s[1],t=s[2],s=s[0]),setTimeout(function(){var t=d(e.slides[i]);t.css("background-image","none"),"opacity"!=e.property&&t[0].fx.css("opacity",1),e.transition?(t[0].fx.css(e.endEffect),e.transform&&t[0].fx.css(e.transform,"scale(1.0)")):("ifade"==e.options.effect&&(s.css("max-width","30%"),s.animate({maxWidth:"100%"},e.options.duration,e.options.transition)),t[0].fx.animate(e.endEffect,e.options.duration,e.options.transition))},t),s.off("load",n)}.bind(e,[i,t,o]);i.removeAttr("src"),i.on("load",n),i.data();var a=i.data("sizes"),r=i.data("srcset"),c=i.data("src");i.removeAttr("data-sizes data-srcset data-src"),a&&r?(i.attr("sizes",a),i.attr("srcset",r),picturefill({elements:[i[0]]})):i.attr("src",c)}},t.prototype.loadSlides=function(){var i=this,s=d(window).scrollTop()+d(window).height();i.slides.each(function(t){d(this).offset().top<s&&i.loadSlide(t,!0)});var t=function(){var s=d(window).scrollTop()+d(window).height();i.slides.each(function(t){d(this).offset().top<s&&i.loadSlide(t,!1)}),i.loaded==i.slides.length&&(d(window).off("scroll",t),d(window).off("resize",t))};d(window).on("scroll",t),d(window).on("resize",t),d(window).on("load",t)},t.prototype.setGridEvents=function(){var s=this;s.elementsToShow=s.grid.find(".showOnMouseOver"),s.elementsToShow.each(function(t){(t=d(this)).css("opacity",0),s.transition&&t.css(s.transition,"opacity 200ms ease"),t.on("mouseenter",function(){s.transition?t.css("opacity",1):t.animate({opacity:1},200)}),t.on("mouseleave",function(){s.transition?t.css("opacity",.5):t.animate({opacity:.5},200)})}),s.grid.on("mouseenter",function(){s.slides.each(function(){var t=d(this);t.hasClass("active")||(s.transition?t.css("opacity",.3):t.animate({opacity:.3},200))}),s.elementsToShow.each(function(){var t=d(this);s.transition?t.css("opacity",.5):t.animate({opacity:.5},200)})}),s.grid.on("mouseleave",function(){s.slides.each(function(){var t=d(this);t.hasClass("active")&&s.hideItem(t)}),s.transition?s.slides.css("opacity",1):s.slides.animate({opacity:1},200),s.elementsToShow.each(function(){var t=d(this);s.transition?t.css("opacity",0):t.animate({opacity:0},200)})}),s.grid.find(".dj-gallery-end").first().on("focus",function(){s.grid.trigger("mouseleave")})},t.prototype.support=function(t){var s=(document.body||document.documentElement).style;if(void 0===s)return!1;if("string"==typeof s[t])return t;v=["Moz","Webkit","Khtml","O","ms","Icab"],pu=t.charAt(0).toUpperCase()+t.substr(1);for(var i=0;i<v.length;i++)if("string"==typeof s[v[i]+pu])return"-"+v[i].toLowerCase()+"-"+t}}(jQuery);